---
title: حل تحدي outbound
date: 2025-11-13
tags: ["CVEs","Ciphers","HTB"]
description: CVE-2025-49113 / decrypt / CVE-2025-27591
image: https://htb-mp-prod-public-storage.s3.eu-central-1.amazonaws.com/avatars/b1096fc86df3fb6035baad7f599094be.png
---

## المقدمة
بسم الله الرحمن الرحيم. في هذا التحدي نواجه سيرفر يحتوي على تطبيق roundcube بإصدار 1.6.10 واللي مرتبط بثغرة من تصنيف RCE، يمدينا نستغل هذه الثغرة عشان نحصل على اتصال عكسي من السيرفر. بعد ماندخل السيرفر ونبدأ عملية البحث عن طريقة لتصعيد الصلاحيات نحصل ملف config.inc.php فيه معلومات مستخدم قاعدة البيانات؛ بعد البحث داخل قاعدة البيانات نحصل اسم المستخدم وكلمة المرور المشفرة لهذا المستخدم، بعد بحث بسيط في قوقل نعرف أن يمدينا نفك تشفير كلمة المرور باستخدام مفتاح DES نحصله داخل ملف config.inc.php . يمدينا بعدين ندخل على حساب هذا المستخدم على roundcube ونشوف أن أحد الإيميلات يحتوي على كلمة مرور ثانية يمدينا نستعملها عشان ندخل على السيرفر من خلال ssh وناخذ العلم الأول. العلم الثاني بسيط ومحبط نوعًا ما، فيه برنامج باسم below يمدينا نشغله بصلاحيات الروت، الإصدار حق هذا البرنامج فيه ثغرة من خلالها نقدر نسوي حساب جديد بصلاحيات الروت، بهذا الشكل نكون قفلنا التحدي وناخذ علم الروت.

## استطلاع
أول حاجة نبدأ فيها هي التأكد من إننا نقدر نتواصل مع السيرفر، يمدينا نستعمل ping: 

```shell
ping 10.10.11.77       
PING 10.10.11.77 (10.10.11.77) 56(84) bytes of data.
64 bytes from 10.10.11.77: icmp_seq=1 ttl=63 time=271 ms
64 bytes from 10.10.11.77: icmp_seq=2 ttl=63 time=204 ms
64 bytes from 10.10.11.77: icmp_seq=3 ttl=63 time=244 ms
64 bytes from 10.10.11.77: icmp_seq=4 ttl=63 time=205 ms
64 bytes from 10.10.11.77: icmp_seq=5 ttl=63 time=204 ms

--- 10.10.11.77 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4000ms
rtt min/avg/max/mdev = 204.243/225.760/271.361/27.399 ms
```
عندنا الttl قريب 64 وهذا يعني أن السيرفر بنظام لينكس. راح أفحص أكثر مئة مدخل استخدامًا باستخدام nmap:

```shell
sudo nmap -F -sS -v -A 10.10.11.77

Nmap scan report for mail.outbound.htb (10.10.11.77)
Host is up (0.36s latency).
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.6p1 Ubuntu 3ubuntu13.12 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 0c:4b:d2:76:ab:10:06:92:05:dc:f7:55:94:7f:18:df (ECDSA)
|_  256 2d:6d:4a:4c:ee:2e:11:b6:c8:90:e6:83:e9:df:38:b0 (ED25519)
80/tcp open  http    nginx 1.24.0 (Ubuntu)
| http-methods: 
|_  Supported Methods: GET HEAD POST
|_http-title: Roundcube Webmail :: Welcome to Roundcube Webmail
|_http-favicon: Unknown favicon MD5: 924A68D347C80D0E502157E83812BB23
|_http-trane-info: Problem with XML parsing of /evox/about
|_http-server-header: nginx/1.24.0 (Ubuntu)
Device type: general purpose
Running: Linux 4.X|5.X
```
عندنا خدمتين على السيرفر، ssh & http. نلاحظ أن nmap قاعد يعطينا hostname للجهاز في أول سطر (mail.outbound.htb) راح أضيف الhostname  هذا عندي في ملف hosts وراح أروح للموقع.

### ملاحظات
```shell
The server OS is Linux and it has two open ports, SSH and HTTP.
you should add the hostname given by nmap to the hosts file to be able to connect 
to the HTTP website
```

## التفاعل مع الموقع واستغلال الثغرة
أول ما نروح على موقع الويب نلاحظ تطبيق معروف وهو roundcube وهو تطبيق خاص بتنظيم وإرسال واستلام الإيميلات، في وصف التحدي عندنا بيانات المستخدم التجريبي حقنا، يمدينا نسجل دخول باستخدام هذه البيانات
![roundcube_main_tyler](../assets/img/rc_main_tyler.png)
أسفل الصفحة على اليسار نلاحظ عندنا زر باسم about راح يعطينا معلومات عن التطبيق ومن ضمنها الإصدار
![roundcube_main_about](../assets/img/outbound_rc_version.png)
عندنا إصدار 1.6.10 إذا بحثنا في الويب عن roundcube 1.6.10 exploit راح نحصل CVE-2025-49113 مرتبطة بهذا الإصدار؛ يمدينا من خلالها نفتح اتصال عكسي مع السيرفر، فيه [هذا السكربت من exploitdb](https://www.exploit-db.com/exploits/52324) يمدينا نستخدمه داخل MetaSploit :
![msf_search](../assets/img/outbound_msf_search.png)
بعد مانعدل على الإعدادات ونشغل السكربت نلاحظ أن جانا إتصال عكسي من السيرفر وصار يمدينا ننفذ أوامر على السيرفر من خلال المستخدم www-data:
![msf_run](../assets/img/outbound_exploit_run.png)
## الملاحظات
```shell
Using the credentials given in the challenge descreption we can login to roundcube,
after footprinting we find that the version of roundcube is 1.6.10 .
When searching for this version we find a CVE-2025-49113 for it.
Using this CVE allows us to remotely connect to the server.
```

## الحصول على معلومات المستخدم jacob
بعد ماندخل على السيرفر يمدينا نستعمل سكربت linpeas.sh لكن ماراح نحصل شيء مفيد، بما أن عندنا موقع ويب راح نروح على مجلد var/www/html/ واللي في كثير من الأحيان يحتوي على السورس كود الخاص بالموقع.
![normal_shell](../assets/img/outbound_normal_shell.png)
نلاحظ أن shell اللي عندنا بدائية جدًا، راح أستعمل socat عشان أطورها لأن السيرفر مافيه ثنائية بايثون.
![upgraded_shell](../assets/img/outbound_upgraded_shell.png)
الآن بما أن عندنا shell متطورة يمدينا نتفاعل مع السيرفر بشكل ممتاز. أحد المجلدات الملفتة للنظر هو مجلد config وغالبا يحتوي على ملفات إعدادات الموقع، ممكن نحصل داخلها معلومات مهمة.
```shell
www-data@mail:~/html/roundcube$ cd config
www-data@mail:~/html/roundcube/config$ ls
config.inc.php	config.inc.php.sample  defaults.inc.php  mimetypes.php
www-data@mail:~/html/roundcube/config$ cat config.inc.php
<?php
...
 | Local configuration for the Roundcube Webmail
...
$config['db_dsnw'] = 'mysql://REDACTED:REDACTED@localhost/roundcube';
...
$config['des_key'] = 'REDACTED';
```
في ملف config.inc.php عندنا معلومات مستخدم قاعدة البيانات وعندنا مفتاح DES راح نحتاجه بعد شوي. بعد مادخلت قاعدة البيانات عرضت البيانات الموجودة داخل طاولة باسم users لكن ماوجدت أي معلومة ممكن تفيدني، عرضت معلومات طاولة ثانية باسم session واللي داخلها حصلت نص مشفر base64 يحتوي على اسم أحد المستخدمين في النظام وكلمة المرور حقته مشفرة base64.
![db](../assets/img/outbound_db.png)
![users](../assets/img/outbound_db_users.png)
![sessions](../assets/img/outbound_db_session.png)
يمدينا ناخذ النص المشفر الموجود في طاولة session ونعطيه [CyberChef](https://gchq.github.io/CyberChef/) عشان نفك التشفير ونشوف النص الأصلي
![cyberchef](../assets/img/outbound_cyberchef.png)
أحد المعلومات الموجودة في هذا النص هي كلمة المرور، لو حاولنا نفك تشفيرها باستخدام أدوات مثل CyberChef ماراح ننجح لأن roundcube عنده طريقة خاصة في تشفير كلمات المرور، لكن بعد بحث بسيط على الويب نقدر نحصل [هذا السكربت](https://github.com/rafelsusanto/rcube-password-decryptor) اللي يطلب مفتاح DES اللي حصلناه في ملف config.inc.php عشان يعطينا كلمة المرور.
```shell
╰─❯ python rcube-decrypt.py
Paste base64 encrypted password (from session): REDACTED
Paste 24-byte des_key (from config.inc.php): REDACTED
IV: 2fb46fd3403c4eec
Ciphertext: REDACTED
Unpadded (hex): REDACTED
Decrypted password (utf-8): REDACTED
Printable ASCII: REDACTED
```
كلمة المرور هذي خاصة بتطبيق roundcube فلذلك راح أستعملها عشان أسجل دخول لحساب jacob:
![alt text](../assets/img/outbound_roundcube_jacob.png)
أحد الإيميلات تتحدث عن تغيير كلمة مرور المستخدم jacob ونفس الإيميل يحتوي على كلمة المرور الجديدة واللي من خلالها نقدر نسجل دخول على السيرفر باستخدام SSH:
![alt text](../assets/img/outbound_jacob_ssh.png)

## الملاحظات
```shell
After gaining access to the server via the exploit, we start enumerating the server and 
find a file named config.inc.php under /var/www/html/roundcube/config/. 
This file containes credentials for the database and a DES key. 
After connecting to the database named roundcube we find two interesting tables, 
session and users. The users table does not have any valuable information, 
the session table however containes the session information for the user jacob; 
in that information we find the base64 encoded password. 
Searching online we find a decrypt script that needs the DES key and the encoded password 
to reverse encode it and spit out the original password 
text. Using this password we can login to roundcube and obtain the password for SSH.
```

## تصعيد الصلاحيات
بعد ماندخل على السيرفر باستخدام SSH راح نبدأ عملية البحث مرة أخرى، وبما أننا نعرف كلمة مرور المستخدم jacob يمدينا نبدأ بأمر sudo -l واللي يخلينا نشوف الثنائيات اللي يمدينا ننفذها من خلال هذا المستخدم باستخدام sudo:
![sudo -l](../assets/img/outbound_sudol.png)
عندنا ثنائية باسم below ، يمدينا نقرأ طريقة استعمالها لكن من نظرة سطحية ماراح نحصل طريقة لتصعيد الصلاحيات. إذا بحثنا في الويب عن privilege escalation "below" binary site:github.com راح نحصل [هذا السكربت](https://github.com/00xCanelo/CVE-2025-27591) كأحد النتائج, بما أن عندنا اتصال من خلال SSH يمدينا ننسخ الكود ونكتبه مباشرة على السيرفر بدون ماننقل الملف من جهازنا.
![nano exploit](../assets/img/outbound_exploit_nano.png)
![run exploit privesc](../assets/img/outbound_privesc.png)

## ملاحظة
أنا أحل تحديات في منصة HackTheBox وبدأت الآن أنتقل إلى المستوى المتوسط، والصراحة إني صرت ما أحب أكتب عن التحديات السهلة ذي وأعتقد واضح من كتابتي إنعدام حماسي لمثل هذي التحديات لأنها صارت مملة نوعًا ما، يعني لازم تستغل CVE معين عشان تدخل على الجهاز بعدين تدور على CVE ثاني عشان تصعد الصلاحيات الخ... عشان كذا التحديات اللي زي ذي تعتمد على CVEs ماراح أكتب عنها إلا إذا كانت فيه فكرة محترمة. إن شاء الله مستقبلًا راح أكتب عن تحديات أعجبتني مثل imagery واللي مافيه أي CVE، كله شغل يدوي متعب لكن ممتع جدًا.